(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{30:function(e,t){e.exports="data:image/jpeg;base64,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"},44:function(e,t,a){e.exports=a(74)},49:function(e,t,a){},61:function(e,t,a){},62:function(e,t,a){},63:function(e,t,a){},64:function(e,t,a){},65:function(e,t,a){},67:function(e,t,a){},68:function(e,t,a){},69:function(e,t,a){},70:function(e,t,a){},72:function(e,t,a){},73:function(e,t,a){},74:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),s=a(15),c=a.n(s);a(49),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var i=a(8),o=a(4),u=a(27),l=a(3),A=a(7),f=a(20),g=a(2),d=a.n(g),p=a(5),m=a(25),h=a(26),v=a(11),E=a.n(v),b=(a(51),a(55),a(75),{apiKey:"AIzaSyDus1I-dkUE4CtOZNlpt8ZKXL5pl1FZ0Mw",authDomain:"saper-ce3aa.firebaseapp.com",databaseURL:"https://saper-ce3aa.firebaseio.com",projectId:"saper-ce3aa",storageBucket:"saper-ce3aa.appspot.com",messagingSenderId:"320043537840",appId:"1:320043537840:web:3d6e8c76ea84c5aa7bb275",measurementId:"G-GZT12414FL"}),O=new(function(){function e(){Object(m.a)(this,e),E.a.initializeApp(b),this.auth=E.a.auth(),this.db=E.a.firestore(),this.storageRef=E.a.storage().ref()}return Object(h.a)(e,[{key:"login",value:function(e,t){return this.auth.signInWithEmailAndPassword(e,t)}},{key:"register",value:function(){var e=Object(p.a)(d.a.mark((function e(t,a,n){var r,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.auth.createUserWithEmailAndPassword(a,n);case 3:return r=e.sent,s=r.user,e.next=7,s.updateProfile({displayName:t});case 7:return e.next=9,this.db.collection("users").doc(s.uid).set({exists:!0,displayName:s.displayName});case 9:return e.abrupt("return","Success");case 12:e.prev=12,e.t0=e.catch(0),console.log("REGISTER ERROR: ",e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"logout",value:function(){return this.auth.signOut()}},{key:"sendMessage",value:function(){var e=Object(p.a)(d.a.mark((function e(t,a){var n,r,s=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.db.collection("users").doc(this.auth.currentUser.uid),r=this.db.collection("users").doc(a),e.prev=2,e.next=5,this.db.runTransaction(function(){var e=Object(p.a)(d.a.mark((function e(c){var i,o,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.get(n);case 2:return e.next=4,e.sent.data();case 4:i=e.sent,o=i.friends,(u=o[a])||(l=s.db.collection("chats").doc(),u=l.id,n.set({friends:Object(f.a)({},a,u)},{merge:!0}),r.set({friends:Object(f.a)({},s.auth.currentUser.uid,u)},{merge:!0})),s.db.collection("chats").doc(u).collection("messages").add({from:s.auth.currentUser.uid,text:t,createdAt:E.a.firestore.FieldValue.serverTimestamp()});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log("Transaction failure:",e.t0.message);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"cancelPreviousListener",value:function(){this.unsubscribe&&this.unsubscribe()}},{key:"listenForNewMessages",value:function(){var e=Object(p.a)(d.a.mark((function e(t,a){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.collection("users").doc(this.auth.currentUser.uid).get();case 2:return e.next=4,e.sent.data();case 4:if(n=e.sent,(r=n.friends)[a]){e.next=8;break}return e.abrupt("return",[]);case 8:this.unsubscribe=this.db.collection("chats").doc(r[a]).collection("messages").where("createdAt",">=",E.a.firestore.Timestamp.fromDate(new Date)).onSnapshot((function(e){if(e.empty)return[];console.log("SIZE: ",e.size);var a=[];e.docChanges().forEach((function(e){if("added"===e.type){console.log("NEW MESSAGE: ",e.doc.data());var t=e.doc.data(),n=t.from,r=t.text,s=t.createdAt;a.push({from:n,text:r,createdAt:s,id:e.doc.id})}})),t(a)}));case 9:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"get10PreviousMessages",value:function(){var e=Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.lastMessageSnapshot){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,this.db.collection("chats").doc(this.chatID).collection("messages").orderBy("createdAt","desc").startAfter(this.lastMessageSnapshot).limit(10).get();case 4:return t=e.sent,this.lastMessageSnapshot=t.docs[t.docs.length-1],e.abrupt("return",t.docs.map((function(e){return Object(A.a)({},e.data(),{id:e.id})})).reverse());case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getLast20Messages",value:function(){var e=Object(p.a)(d.a.mark((function e(t){var a,n,r,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.db.collection("users").doc(this.auth.currentUser.uid).get();case 3:return e.next=5,e.sent.data();case 5:if(a=e.sent,(n=a.friends)[t]){e.next=9;break}return e.abrupt("return",[]);case 9:return this.chatID=n[t],e.next=12,this.db.collection("chats").doc(this.chatID).collection("messages").orderBy("createdAt","desc").limit(20).get();case 12:return r=e.sent,s=r.docs.length,this.lastMessageSnapshot=s<20?void 0:r.docs[s-1],e.abrupt("return",r.docs.map((function(e){return Object(A.a)({},e.data(),{id:e.id})})).reverse());case 18:return e.prev=18,e.t0=e.catch(0),console.log("getLast20Messages error try/catch: ",e.t0),e.abrupt("return",e.t0.message);case 22:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getMyUID",value:function(){return this.auth.currentUser.uid}},{key:"getUserInfo",value:function(){}},{key:"changeProfilePicture",value:function(){var e=Object(p.a)(d.a.mark((function e(t){var a=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=a.storageRef.child("profilePictures/".concat(a.auth.currentUser.uid));console.log("fullPath: ",r.fullPath),console.log("name: ",r.name),console.log("bucket: ",r.bucket);var s=r.put(t);s.on("state_changed",(function(e){var t=e.bytesTransferred/e.totalBytes*100;switch(console.log("Upload is "+t+"% done"),e.state){case E.a.storage.TaskState.PAUSED:console.log("Upload is paused");break;case E.a.storage.TaskState.RUNNING:console.log("Upload is running")}}),(function(e){console.log("ERROR in uploadTask: ",e),n(e.message)}),(function(){s.snapshot.ref.getDownloadURL().then((function(t){console.log("File available at",t),e(t)}))}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMyAvatarURL",value:function(){var e=Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.avatarURL){e.next=2;break}return e.abrupt("return",this.avatarURL);case 2:return e.next=4,this.storageRef.child("profilePictures/".concat(this.auth.currentUser.uid)).getDownloadURL();case 4:return t=e.sent,this.avatarURL=t,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUsersNameAndID",value:function(){var e=Object(p.a)(d.a.mark((function e(){var t,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.collection("users").get();case 2:return t=e.sent,a=t.docs.map((function(e){return{displayName:e.data().displayName,userID:e.id}})),console.log("getUSersInfo: ",a),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUsersAvatars",value:function(){var e=Object(p.a)(d.a.mark((function e(){var t,a,n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageRef.child("profilePictures").listAll();case 2:return t=e.sent,console.log("usersAvatarList: ",t),a=t.items.map((function(e){return e.getDownloadURL()})),e.next=7,Promise.all(a);case 7:return n=e.sent,r=n.map((function(e){return{avatarURL:e,avatarID:e.slice(88,116)}})),console.log("avatarData: ",r),e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUsersProfilesData",value:function(){var e=Object(p.a)(d.a.mark((function e(){var t,a,n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUsersNameAndID();case 2:return t=e.sent,e.next=5,this.getUsersAvatars();case 5:return a=e.sent,n=a.map((function(e){return e.avatarID})),r=t.map((function(e){var t=e.displayName,r=e.userID,s=n.indexOf(r);return-1===s?{displayName:t,userID:r,avatarURL:null}:{displayName:t,userID:r,avatarURL:a[s].avatarURL}})),e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}()),w=r.a.createContext({currentUser:null}),S=function(e){var t=e.children,a=Object(n.useState)(null),s=Object(l.a)(a,2),c=s[0],i=s[1],o=Object(n.useState)(!0),u=Object(l.a)(o,2),A=u[0],f=u[1];return Object(n.useEffect)((function(){O.auth.onAuthStateChanged((function(e){i(e),f(!1)}))}),[]),A?r.a.createElement(r.a.Fragment,null,"Loading..."):r.a.createElement(w.Provider,{value:{currentUser:c}},t)},y=function(e){var t=e.children,a=Object(u.a)(e,["children"]);return Object(n.useContext)(w).currentUser?r.a.createElement(o.b,a,t):r.a.createElement(o.a,{to:"/login"})},D=(a(61),function(){var e=Object(o.g)(),t=Object(n.useState)("dominik5@onet.com.pl"),a=Object(l.a)(t,2),s=a[0],c=a[1],u=Object(n.useState)("dupadupa"),A=Object(l.a)(u,2),f=A[0],g=A[1];return r.a.createElement("div",{id:"login-container"},r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),O.login(s,f).then((function(t){t.user;e.replace("/chat")})).catch((function(e){return console.log("ERR: ",e)}))},id:"login-form"},r.a.createElement("fieldset",null,r.a.createElement("legend",null,"Welcome to ",r.a.createElement("span",{className:"login-text-highlight"},"Messengera")),r.a.createElement("div",{className:"container-row"},r.a.createElement("button",{className:"button-auth-provider"},"Google"),r.a.createElement("button",{className:"button-auth-provider"},"Facebook")),r.a.createElement("input",{type:"email",name:"email",id:"login-input-email",className:"login-input",value:s,onChange:function(e){return c(e.target.value)},placeholder:"Email"}),r.a.createElement("input",{type:"password",name:"password",id:"login-input-password",className:"login-input",value:f,onChange:function(e){return g(e.target.value)},placeholder:"Password"}),r.a.createElement("button",{id:"login-submit-button"},"Sign in"),r.a.createElement("div",{id:"register-bottom-container"},r.a.createElement("span",null," Don't have an account yet?"),r.a.createElement(i.b,{id:"register-bottom-container__link",to:"/register"},"Sign up here!")))))}),j=(a(62),a(63),function(e){var t=e.friendsProfilesData,s=e.indexOfChosenFriend,c=e.setIndexOfChosenFriend;return Object(n.useEffect)((function(){}),[t]),r.a.createElement("div",{id:"contact-list-container"},t.map((function(e,t){var n=e.displayName,o=e.userID,u=e.avatarURL,l=s===t;return r.a.createElement("li",{onClick:function(){return c(t)},className:"list-item ".concat(l&&"list-item--current"),key:o},r.a.createElement(i.b,{to:"/chat/".concat(o),className:"list-item__link"},r.a.createElement("img",{src:u||a(30),alt:"Profile picture",className:"list-item__avatar",width:"50",height:"50"}),n))})))}),I=(a(64),a(65),a(37)),R=a.n(I),M=(a(66),a(67),function(e){var t=e.open,a=e.children;return t?c.a.createPortal(r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{id:"overlay"},a)),document.getElementById("portal")):null}),C=(a(68),function(e){var t=e.styles,a=(t=void 0===t?{borderColor:"dodgerblue",margin:"auto"}:t).borderColor,n=t.margin;return r.a.createElement("div",{className:"lds-ring",style:{margin:n}},Array.from({length:4}).map((function(e,t){return r.a.createElement("div",{style:{borderColor:"".concat(a," transparent transparent transparent")}})})))}),x=a(38),k=function(){var e=Object(n.useState)(!1),t=Object(l.a)(e,2),s=t[0],c=t[1],i=Object(n.useState)({minWidth:80,width:80,maxWidth:100,x:10,y:10,aspect:1,unit:"%"}),o=Object(l.a)(i,2),u=o[0],A=o[1],f=Object(n.useState)(null),g=Object(l.a)(f,2),m=(g[0],g[1]),h=Object(n.useState)(!1),v=Object(l.a)(h,2),E=v[0],b=v[1],w=Object(n.useState)(""),S=Object(l.a)(w,2),y=S[0],D=S[1],j=Object(n.useState)(""),I=Object(l.a)(j,2),k=I[0],P=I[1],F=Object(n.useState)(!1),N=Object(l.a)(F,2),_=N[0],T=N[1],L=Object(n.useRef)();Object(n.useEffect)((function(){(function(){var e=Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.getMyAvatarURL();case 2:t=e.sent,P(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);var Q=function(e,t,a){var n=document.createElement("canvas"),r=e.naturalWidth/e.width,s=e.naturalHeight/e.height;n.width=t.width,n.height=t.height;var c=n.getContext("2d");if(null!==c)return c.drawImage(e,t.x*r,t.y*s,t.width*r,t.height*s,0,0,t.width,t.height),new Promise((function(e,t){n.toBlob((function(t){if(t){t.name=a,k&&(console.log("BLOB: ",t),window.URL.revokeObjectURL(k));var n=window.URL.createObjectURL(t);e({newAvatarUrl:n,blob:t})}}),"image/jpeg")}))},B=function(){var e=Object(p.a)(d.a.mark((function e(){var t,a,n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!L.current||!u.width){e.next=22;break}return e.prev=1,T(!0),e.next=5,Q(L.current,u,"avatar.jpeg");case 5:return t=e.sent,a=t.newAvatarUrl,n=t.blob,P(a),e.next=11,O.changeProfilePicture(n);case 11:r=e.sent,console.log("Success: ",r),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),console.log("Error: ",e.t0.message);case 18:return e.prev=18,T(!1),b(!1),e.finish(18);case 22:case"end":return e.stop()}}),e,null,[[1,15,18,22]])})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){console.log("imageDataUrl; ",y)}),[y]),r.a.createElement("div",{id:"container-settings"},r.a.createElement("button",{id:"container-settings__title",onClick:function(){c((function(e){return!e}))}},r.a.createElement("span",{id:"settings-title"},"Settings"),r.a.createElement(x.a,{className:"settings-icon ".concat(s?"settings-icon--rotated":"")})),r.a.createElement("div",{className:"container-settings__collapsible ".concat(s?"container-settings__collapsible--opened":"container-settings__collapsible--closed")},r.a.createElement("div",{id:"avatar-container"},r.a.createElement("img",{src:k||a(30),alt:"Avatar",id:"avatar-image"}),r.a.createElement("label",{htmlFor:"input-avatar",id:"input-avatar__label"},"Change avatar"),r.a.createElement("input",{id:"input-avatar",type:"file",accept:"image/png, image/jpeg",onChange:function(e){if(e.target.files&&e.target.files.length>0){var t=new FileReader;t.addEventListener("load",(function(){D(t.result),console.log("reader result: ",t.result),b(!0)})),t.readAsDataURL(e.target.files[0]),e.target.value=""}}}),r.a.createElement(M,{open:E,onClose:function(){return b(!1)},getCroppedImg:Q},r.a.createElement("div",{id:"modal",onClick:function(e){return e.stopPropagation()}},r.a.createElement("div",{id:"modal-image-container"},r.a.createElement(R.a,{src:y,crop:u,onChange:function(e,t){A(e)},onComplete:function(e){m(e)},onImageLoaded:function(e){L.current=e},imageStyle:U,circularCrop:!0,ruleOfThirds:!0})),r.a.createElement("div",{id:"modal-buttons-container"},r.a.createElement("button",{className:"modal-button modal-button--cancel",onClick:function(){return b(!1)}},"Cancel"),r.a.createElement("button",{className:"modal-button modal-button--save",onClick:B},_&&r.a.createElement(C,{styles:{borderColor:"white",margin:"0px"}}),"Save")))))))},U={width:"auto",maxHeight:"450px",objectFit:"contain"},P=(a(69),function(e){var t=e.profilesDataOfChosenFriend;if(Object(n.useEffect)((function(){console.log("XXX: ",t)}),[t]),!t)return null;var s=t.avatarURL,c=t.displayName;return r.a.createElement("div",{id:"flex-info-container"},r.a.createElement("div",{id:"friend-avatar-container"},r.a.createElement("img",{src:s||a(30),alt:"",id:"friend-avatar"}),r.a.createElement("span",{id:"friend-name"},c)))}),F=function(e){var t=e.profilesDataOfChosenFriend;return r.a.createElement("div",{id:"right-panel-container"},r.a.createElement(k,null),r.a.createElement(P,{profilesDataOfChosenFriend:t}))},N=a(42),_=a(43),T=(a(70),a(12)),L=function(e){return{type:"ADD_LAST_20_MESSAGES",payload:{messages:e}}},Q=function(e){return{type:"ADD_ERROR",payload:{error:e}}},B=function(e){return{type:"ADD_NEW_MESSAGES",payload:{messages:e}}},G=function(e){return{type:"ADD_10_PREVIOUS_MESSAGES",payload:{messages:e}}},K=function(){return{type:"START_FETCHING_20_LAST_MESSAGES"}},H=function(){return{type:"STOP_FETCHING_20_LAST_MESSAGES"}},J=function(){return{type:"START_FETCHING_10_PREVIOUS_MESSAGES"}},W=function(){return{type:"STOP_FETCHING_10_PREVIOUS_MESSAGES"}},V=function(e){Object(_.a)(a,e);var t=Object(N.a)(a);function a(e){var r;return Object(m.a)(this,a),(r=t.call(this,e)).currentUserID=void 0,r.intersectionObserverRef=void 0,r.firstMessageRef=void 0,r.messagesContainerRef=void 0,r.setFirstMessageRef=void 0,r.observeFirstMessage=function(){r.intersectionObserverRef.current&&r.intersectionObserverRef.current.disconnect(),r.intersectionObserverRef.current=new IntersectionObserver((function(e){e[0].isIntersecting&&r.props.fetch10PreviousMessages()})),r.firstMessageRef&&r.intersectionObserverRef.current&&r.intersectionObserverRef.current.observe(r.firstMessageRef)},r.state={},r.currentUserID=O.getMyUID(),r.intersectionObserverRef=Object(n.createRef)(),r.firstMessageRef=null,r.messagesContainerRef=Object(n.createRef)(),r.setFirstMessageRef=function(e){r.firstMessageRef=e},r}return Object(h.a)(a,[{key:"componentDidMount",value:function(){this.observeFirstMessage(),this.props.fetchLast20Messages(this.props.friendID)}},{key:"getSnapshotBeforeUpdate",value:function(e){return e.messages.length<this.props.messages.length&&this.messagesContainerRef.current?this.messagesContainerRef.current.scrollHeight-this.messagesContainerRef.current.scrollTop:null}},{key:"componentDidUpdate",value:function(e,t,a){e.friendID!==this.props.friendID&&this.props.fetchLast20Messages(this.props.friendID),e.messages!==this.props.messages&&this.observeFirstMessage(),null!==a&&this.messagesContainerRef.current&&(this.messagesContainerRef.current.scrollTop=this.messagesContainerRef.current.scrollHeight-a)}},{key:"render",value:function(){var e=this;return this.props.isFetching10PreviousMessages&&console.log("FETCHING"),r.a.createElement("div",{id:"messages-container",ref:this.messagesContainerRef},r.a.createElement("div",{className:"spinner-container"},this.props.isFetching10PreviousMessages?r.a.createElement(C,null):r.a.createElement("span",{className:"no-more-messages"},"These are all messages in this conversation")),this.props.isFetching20LastMessages?r.a.createElement(C,null):this.props.messages.map((function(t,a){var n=t.id,s=t.text,c=t.from,i=0===a;return r.a.createElement("div",Object.assign({key:n},i?{ref:e.setFirstMessageRef}:{},{className:"message-wrapper ".concat(e.currentUserID===c?"message-wrapper--position-right":"message-wrapper--position-left")}),r.a.createElement("span",{className:"message"},s))})))}}]),a}(n.Component),Z={fetch10PreviousMessages:function(){return function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(J()),e.prev=1,e.next=4,O.get10PreviousMessages();case 4:void 0===(a=e.sent)?G([]):(t(W()),t(G(a))),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.log("error in fetchLast10Messages: ",e.t0.message),t(Q(e.t0.message));case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()},fetchLast20Messages:function(e){return function(){var t=Object(p.a)(d.a.mark((function t(a,n){var r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a(K()),t.prev=1,t.next=4,O.getLast20Messages(e);case 4:void 0===(r=t.sent)?L([]):(a(H()),a(L(r))),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),console.log("error in fetchLast20Messages: ",t.t0.message),a(Q(t.t0.message));case 12:return t.prev=12,n().chat.messages.length>0&&(console.log("HERE finally"),O.cancelPreviousListener(),O.listenForNewMessages((function(e){return a(B(e))}),e)),t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[1,8,12,15]])})));return function(e,a){return t.apply(this,arguments)}}()}},z=Object(T.b)((function(e){return{messages:e.chat.messages,isFetching20LastMessages:e.chat.isFetching20LastMessages,isFetching10PreviousMessages:e.chat.isFetching10PreviousMessages}}),Z)(V),X=(a(72),a(40)),Y=function(e){var t=e.friendID,a=Object(T.c)(),s=Object(n.useState)(""),c=Object(l.a)(s,2),i=c[0],o=c[1];return Object(n.useEffect)((function(){})),r.a.createElement("form",{id:"form-chat",onSubmit:function(e){e.preventDefault(),""!==i&&(a(function(e,t){return function(){var a=Object(p.a)(d.a.mark((function a(n,r){var s;return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:s=r();try{O.sendMessage(e,t).then((function(){console.log("sendMessage")}))}catch(c){n(Q(c.message))}finally{0===s.chat.messages.length&&(console.log("HERE 0"),O.cancelPreviousListener(),O.listenForNewMessages((function(e){return n(B(e))}),t))}case 2:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}()}(i,t)),o(""))}},r.a.createElement("input",{type:"text",id:"input-chat",value:i,onChange:function(e){return o(e.target.value)},placeholder:"Type message..."}),r.a.createElement("button",{id:"submit-chat-button"},r.a.createElement(X.a,{id:"submit-chat-button__icon"})))},q=function(){var e=Object(o.g)(),t=Object(n.useState)([]),a=Object(l.a)(t,2),s=a[0],c=a[1],i=Object(n.useState)(0),u=Object(l.a)(i,2),A=u[0],f=u[1];return Object(n.useEffect)((function(){(function(){var e=Object(p.a)(d.a.mark((function e(){var t,a,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=O.getMyUID(),e.next=4,O.getUsersProfilesData();case 4:a=e.sent,console.log("usersProfileData: ",a),n=a.filter((function(e){return e.userID!==t})),c(n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log("ERROR IN fetchUsersProfilesData: ",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}})()()}),[]),"/chat"===Object(o.h)().pathname&&s.length&&e.replace("/chat/".concat(s[0].userID)),r.a.createElement("div",{className:"container-screen"},r.a.createElement(j,{friendsProfilesData:s,indexOfChosenFriend:A,setIndexOfChosenFriend:f}),r.a.createElement("div",{id:"container-chat"},r.a.createElement(o.d,null,r.a.createElement(o.b,{path:"/chat/:friendID",render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(z,{friendID:e.match.params.friendID}),r.a.createElement(Y,{friendID:e.match.params.friendID}))}}))),r.a.createElement(F,{profilesDataOfChosenFriend:s[A]}))},$=(a(73),function(){var e=Object(n.useState)("donek"),t=Object(l.a)(e,2),a=t[0],s=t[1],c=Object(n.useState)("dominik1@onet.com.pl"),u=Object(l.a)(c,2),A=u[0],f=u[1],g=Object(n.useState)("dupadupa"),d=Object(l.a)(g,2),p=d[0],m=d[1],h=Object(n.useState)("dupadupa"),v=Object(l.a)(h,2),E=v[0],b=v[1],w=Object(o.g)();return r.a.createElement("div",{id:"register-container"},r.a.createElement("form",{id:"register-form",onSubmit:function(e){e.preventDefault(),O.register(a,A,p).then((function(e){w.push("/login")})).catch((function(e){return console.log("REGISTER ERR: ",e)}))}},r.a.createElement("fieldset",null,r.a.createElement("legend",null,"Welcome to"," ",r.a.createElement("span",{className:"register-text-highlight"},"Messenger")),r.a.createElement("input",{type:"text",id:"register-form-name",className:"register-input",placeholder:"Username",value:a,onChange:function(e){return s(e.target.value)}}),r.a.createElement("input",{type:"email",id:"register-form-email",className:"register-input",placeholder:"Email",value:A,onChange:function(e){return f(e.target.value)}}),r.a.createElement("input",{type:"password",id:"register-form-password",placeholder:"Password",className:"register-input",value:p,onChange:function(e){return m(e.target.value)}}),r.a.createElement("input",{type:"password",id:"register-form-password-confirmation",placeholder:"Password confirmation",className:"register-input",value:E,onChange:function(e){return b(e.target.value)}}),r.a.createElement("button",{id:"register-submit-button"},"Sign up"),r.a.createElement("div",{id:"register-bottom-container"},r.a.createElement("span",null," Already have an account?"),r.a.createElement(i.b,{id:"register-bottom-container__link",to:"/login"},"Sign in here!")))))}),ee=function(e){var t=e.children,a=Object(u.a)(e,["children"]);return Object(n.useContext)(w).currentUser?r.a.createElement(o.a,{to:"/chat"}):r.a.createElement(o.b,a,t)},te=a(14),ae=a(41),ne=a(17),re={messages:[],friendID:void 0,isFetching20LastMessages:!1,isFetching10PreviousMessages:!1,error:void 0},se=Object(te.c)({chat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_LAST_20_MESSAGES":var a=t.payload.messages;return Object(A.a)({},e,{messages:Object(ne.a)(a)});case"ADD_NEW_MESSAGES":return Object(A.a)({},e,{messages:[].concat(Object(ne.a)(e.messages),Object(ne.a)(t.payload.messages))});case"ADD_10_PREVIOUS_MESSAGES":var n=t.payload.messages;return 0===n.length?e:Object(A.a)({},e,{messages:[].concat(Object(ne.a)(n),Object(ne.a)(e.messages))});case"SET_FRIEND_ID":return Object(A.a)({},e,{friendID:t.payload.friendID});case"START_FETCHING_20_LAST_MESSAGES":return Object(A.a)({},e,{isFetching20LastMessages:!0});case"STOP_FETCHING_20_LAST_MESSAGES":return Object(A.a)({},e,{isFetching20LastMessages:!1});case"START_FETCHING_10_PREVIOUS_MESSAGES":return Object(A.a)({},e,{isFetching10PreviousMessages:!0});case"STOP_FETCHING_10_PREVIOUS_MESSAGES":return Object(A.a)({},e,{isFetching10PreviousMessages:!1});case"ADD_ERROR":var r=t.payload.error;return Object(A.a)({},e,{error:r});default:return e}}}),ce=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||te.d,ie=Object(te.e)(se,ce(Object(te.a)(ae.a))),oe=(T.d,ie);c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(T.a,{store:oe},r.a.createElement(S,null,r.a.createElement(i.a,null,r.a.createElement(o.d,null,r.a.createElement(o.a,{exact:!0,from:"/",to:"/chat"}),r.a.createElement(ee,{path:"/login"},r.a.createElement(D,null)),r.a.createElement(ee,{path:"/register"},r.a.createElement($,null)),r.a.createElement(y,{path:"/chat"},r.a.createElement(q,null))))))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[44,1,2]]]);
//# sourceMappingURL=main.914cb177.chunk.js.map