(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{35:function(e,t){e.exports="data:image/jpeg;base64,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"},41:function(e,t,a){e.exports=a(69)},46:function(e,t,a){},58:function(e,t,a){},59:function(e,t,a){},60:function(e,t,a){},61:function(e,t,a){},63:function(e,t,a){},64:function(e,t,a){},65:function(e,t,a){},67:function(e,t,a){},68:function(e,t,a){},69:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(14),c=a.n(s);a(46),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var o=a(7),i=a(3),u=a(26),l=a(2),A=a(6),g=a(19),d=a(1),f=a.n(d),m=a(4),p=a(24),h=a(25),E=a(11),b=a.n(E),v=(a(48),a(52),a(70),{apiKey:"AIzaSyDus1I-dkUE4CtOZNlpt8ZKXL5pl1FZ0Mw",authDomain:"saper-ce3aa.firebaseapp.com",databaseURL:"https://saper-ce3aa.firebaseio.com",projectId:"saper-ce3aa",storageBucket:"saper-ce3aa.appspot.com",messagingSenderId:"320043537840",appId:"1:320043537840:web:3d6e8c76ea84c5aa7bb275",measurementId:"G-GZT12414FL"}),w=new(function(){function e(){Object(p.a)(this,e),b.a.initializeApp(v),this.auth=b.a.auth(),this.db=b.a.firestore(),this.storageRef=b.a.storage().ref()}return Object(h.a)(e,[{key:"login",value:function(e,t){return this.auth.signInWithEmailAndPassword(e,t)}},{key:"register",value:function(){var e=Object(m.a)(f.a.mark((function e(t,a,n){var r,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.auth.createUserWithEmailAndPassword(a,n);case 3:return r=e.sent,s=r.user,e.next=7,s.updateProfile({displayName:t});case 7:return e.next=9,this.db.collection("users").doc(s.uid).set({exists:!0,displayName:s.displayName});case 9:return e.abrupt("return","Success");case 12:e.prev=12,e.t0=e.catch(0),console.log("REGISTER ERROR: ",e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"logout",value:function(){return this.auth.signOut()}},{key:"sendMessage",value:function(){var e=Object(m.a)(f.a.mark((function e(t,a){var n,r,s=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.db.collection("users").doc(this.auth.currentUser.uid),r=this.db.collection("users").doc(a),e.prev=2,e.next=5,this.db.runTransaction(function(){var e=Object(m.a)(f.a.mark((function e(c){var o,i,u,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.get(n);case 2:return e.next=4,e.sent.data();case 4:o=e.sent,i=o.friends,(u=i[a])||(l=s.db.collection("chats").doc(),u=l.id,n.set({friends:Object(g.a)({},a,u)},{merge:!0}),r.set({friends:Object(g.a)({},s.auth.currentUser.uid,u)},{merge:!0})),s.db.collection("chats").doc(u).collection("messages").add({from:s.auth.currentUser.uid,text:t,createdAt:b.a.firestore.FieldValue.serverTimestamp()});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log("Transaction failure:",e.t0.message);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){return this.db.collection("users").get()}},{key:"cancelPreviousListener",value:function(){this.unsubscribe&&this.unsubscribe()}},{key:"listenForNewMessages",value:function(){var e=Object(m.a)(f.a.mark((function e(t,a){var n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.collection("users").doc(this.auth.currentUser.uid).get();case 2:return e.next=4,e.sent.data();case 4:if(n=e.sent,(r=n.friends)[a]){e.next=8;break}return e.abrupt("return",[]);case 8:this.unsubscribe=this.db.collection("chats").doc(r[a]).collection("messages").where("createdAt",">=",b.a.firestore.Timestamp.fromDate(new Date)).onSnapshot((function(e){if(e.empty)return[];console.log("SIZE: ",e.size);var a=[];e.docChanges().forEach((function(e){if("added"===e.type){console.log("NEW MESSAGE: ",e.doc.data());var t=e.doc.data(),n=t.from,r=t.text,s=t.createdAt;a.push({from:n,text:r,createdAt:s,id:e.doc.id})}})),t(a)}));case 9:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"get10PreviousMessages",value:function(){var e=Object(m.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.lastMessageSnapshot){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,this.db.collection("chats").doc(this.chatID).collection("messages").orderBy("createdAt","desc").startAfter(this.lastMessageSnapshot).limit(10).get();case 4:return t=e.sent,this.lastMessageSnapshot=t.docs[t.docs.length-1],e.abrupt("return",t.docs.map((function(e){return Object(A.a)({},e.data(),{id:e.id})})).reverse());case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getLast20Messages",value:function(){var e=Object(m.a)(f.a.mark((function e(t){var a,n,r,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.db.collection("users").doc(this.auth.currentUser.uid).get();case 3:return e.next=5,e.sent.data();case 5:if(a=e.sent,(n=a.friends)[t]){e.next=9;break}return e.abrupt("return",[]);case 9:return this.chatID=n[t],e.next=12,this.db.collection("chats").doc(this.chatID).collection("messages").orderBy("createdAt","desc").limit(20).get();case 12:return r=e.sent,s=r.docs.length,this.lastMessageSnapshot=s<20?void 0:r.docs[s-1],e.abrupt("return",r.docs.map((function(e){return Object(A.a)({},e.data(),{id:e.id})})).reverse());case 18:return e.prev=18,e.t0=e.catch(0),console.log("getLast20Messages error try/catch: ",e.t0),e.abrupt("return",e.t0.message);case 22:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getMyUID",value:function(){return this.auth.currentUser.uid}},{key:"getUserInfo",value:function(){}},{key:"changeProfilePicture",value:function(){var e=Object(m.a)(f.a.mark((function e(t){var a=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=a.storageRef.child("profilePictures/".concat(a.auth.currentUser.uid));console.log("fullPath: ",r.fullPath),console.log("name: ",r.name),console.log("bucket: ",r.bucket);var s=r.put(t);s.on("state_changed",(function(e){var t=e.bytesTransferred/e.totalBytes*100;switch(console.log("Upload is "+t+"% done"),e.state){case b.a.storage.TaskState.PAUSED:console.log("Upload is paused");break;case b.a.storage.TaskState.RUNNING:console.log("Upload is running")}}),(function(e){console.log("ERROR in uploadTask: ",e),n(e.message)}),(function(){s.snapshot.ref.getDownloadURL().then((function(t){console.log("File available at",t),e(t)}))}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMyAvatarURL",value:function(){var e=Object(m.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.avatarURL){e.next=2;break}return e.abrupt("return",this.avatarURL);case 2:return e.next=4,this.storageRef.child("profilePictures/".concat(this.auth.currentUser.uid)).getDownloadURL();case 4:return t=e.sent,this.avatarURL=t,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFriendsAvatarURLs",value:function(){var e=Object(m.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}()),O=r.a.createContext({currentUser:null}),S=function(e){var t=e.children,a=Object(n.useState)(null),s=Object(l.a)(a,2),c=s[0],o=s[1],i=Object(n.useState)(!0),u=Object(l.a)(i,2),A=u[0],g=u[1];return Object(n.useEffect)((function(){w.auth.onAuthStateChanged((function(e){o(e),g(!1)}))}),[]),A?r.a.createElement(r.a.Fragment,null,"Loading..."):r.a.createElement(O.Provider,{value:{currentUser:c}},t)},j=function(e){var t=e.children,a=Object(u.a)(e,["children"]);return Object(n.useContext)(O).currentUser?r.a.createElement(i.b,a,t):r.a.createElement(i.a,{to:"/login"})},y=(a(58),function(){var e=Object(i.g)(),t=Object(n.useState)("dominik5@onet.com.pl"),a=Object(l.a)(t,2),s=a[0],c=a[1],u=Object(n.useState)("dupadupa"),A=Object(l.a)(u,2),g=A[0],d=A[1];return r.a.createElement("div",{id:"login-container"},r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),w.login(s,g).then((function(t){t.user;e.replace("/chat")})).catch((function(e){return console.log("ERR: ",e)}))},id:"login-form"},r.a.createElement("fieldset",null,r.a.createElement("legend",null,"Welcome to ",r.a.createElement("span",{className:"login-text-highlight"},"Messengera")),r.a.createElement("div",{className:"container-row"},r.a.createElement("button",{className:"button-auth-provider"},"Google"),r.a.createElement("button",{className:"button-auth-provider"},"Facebook")),r.a.createElement("input",{type:"email",name:"email",id:"login-input-email",className:"login-input",value:s,onChange:function(e){return c(e.target.value)},placeholder:"Email"}),r.a.createElement("input",{type:"password",name:"password",id:"login-input-password",className:"login-input",value:g,onChange:function(e){return d(e.target.value)},placeholder:"Password"}),r.a.createElement("button",{id:"login-submit-button"},"Sign in"),r.a.createElement("div",{id:"register-bottom-container"},r.a.createElement("span",null," Don't have an account yet?"),r.a.createElement(o.b,{id:"register-bottom-container__link",to:"/register"},"Sign up here!")))))}),M=(a(59),a(60),function(e){var t=e.friendsInfo,s=Object(n.useState)(0),c=Object(l.a)(s,2),i=c[0],u=c[1];return Object(n.useEffect)((function(){}),[t]),r.a.createElement("div",{id:"contact-list-container"},t.map((function(e,t){var n=e.displayName,s=e.id,c=i===t;return r.a.createElement("li",{onClick:function(){return u(t)},className:"list-item ".concat(c&&"list-item--current"),key:s},r.a.createElement(o.b,{to:"/chat/".concat(s),className:"list-item__link"},r.a.createElement("img",{src:a(35),alt:"Profile picture",className:"list-item__avatar",width:"50",height:"50"}),n))})))}),R=(a(61),a(36)),I=a.n(R),D=(a(62),a(63),function(e){var t=e.open,a=e.children;return t?c.a.createPortal(r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{id:"overlay"},a)),document.getElementById("portal")):null}),C=(a(64),function(e){var t=e.styles,a=(t=void 0===t?{borderColor:"dodgerblue",margin:"auto"}:t).borderColor,n=t.margin;return r.a.createElement("div",{className:"lds-ring",style:{margin:n}},Array.from({length:4}).map((function(e,t){return r.a.createElement("div",{style:{borderColor:"".concat(a," transparent transparent transparent")}})})))}),k=function(e){var t=e.friendName,s=(Object(i.g)(),Object(n.useState)({minWidth:80,width:80,maxWidth:100,x:10,y:10,aspect:1,unit:"%"})),c=Object(l.a)(s,2),o=c[0],u=c[1],A=Object(n.useState)(null),g=Object(l.a)(A,2),d=(g[0],g[1]),p=Object(n.useState)(!1),h=Object(l.a)(p,2),E=h[0],b=h[1],v=Object(n.useState)(""),O=Object(l.a)(v,2),S=O[0],j=O[1],y=Object(n.useState)(""),M=Object(l.a)(y,2),R=M[0],k=M[1],U=Object(n.useState)(""),P=Object(l.a)(U,2),F=P[0],N=P[1],T=Object(n.useRef)();Object(n.useEffect)((function(){console.log("Avatar URL: ",R),function(){var e=Object(m.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.getMyAvatarURL();case 2:t=e.sent,k(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[]);var Q=function(e,t,a){var n=document.createElement("canvas"),r=e.naturalWidth/e.width,s=e.naturalHeight/e.height;return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(e,t.x*r,t.y*s,t.width*r,t.height*s,0,0,t.width,t.height),new Promise((function(e,t){n.toBlob((function(t){if(t){t.name=a,R&&(console.log("BLOB: ",t),window.URL.revokeObjectURL(R));var n=window.URL.createObjectURL(t);e({newAvatarUrl:n,blob:t})}}),"image/jpeg")}))},B=function(){var e=Object(m.a)(f.a.mark((function e(){var t,a,n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(T.current&&o.width&&o.height)){e.next=22;break}return e.prev=1,N(!0),e.next=5,Q(T.current,o,"avatar.jpeg");case 5:return t=e.sent,a=t.newAvatarUrl,n=t.blob,k(a),e.next=11,w.changeProfilePicture(n);case 11:r=e.sent,console.log("Success: ",r),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),console.log("Error: ",e.t0.message);case 18:return e.prev=18,N(!1),b(!1),e.finish(18);case 22:case"end":return e.stop()}}),e,null,[[1,15,18,22]])})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){console.log("imageDataUrl; ",S)}),[S]),r.a.createElement("div",{id:"friend-info-container"},r.a.createElement("div",{id:"avatar-and-name-container"},r.a.createElement("img",{src:R||a(35),alt:"Avatar",id:"friend-avatar"}),r.a.createElement("span",{id:"friend-name"}," ",t),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"input-avatar"},"Choose file to upload"),r.a.createElement("input",{id:"input-avatar",type:"file",accept:"image/png, image/jpeg",onChange:function(e){if(console.log("handleImageChange: ",e.target.value),e.target.files&&e.target.files.length>0){var t=new FileReader;t.addEventListener("load",(function(){j(t.result),console.log("reader result: ",t.result),b(!0)})),t.readAsDataURL(e.target.files[0]),e.target.value=""}}}),r.a.createElement("button",{onClick:function(){return b(!0)}},"Open Modal"),r.a.createElement(D,{open:E,onClose:function(){return b(!1)},getCroppedImg:Q},r.a.createElement("div",{id:"modal",onClick:function(e){return e.stopPropagation()}},r.a.createElement("div",{id:"modal-image-container"},r.a.createElement(I.a,{src:S,crop:o,onChange:function(e,t){u(e)},onComplete:function(e){d(e)},onImageLoaded:function(e){console.log("onImageLoaded: ",e),T.current=e},imageStyle:x,circularCrop:!0,ruleOfThirds:!0})),r.a.createElement("div",{id:"modal-buttons-container"},r.a.createElement("button",{className:"modal-button modal-button--cancel",onClick:function(){return b(!1)}},"Cancel"),r.a.createElement("button",{className:"modal-button modal-button--save",onClick:B},F&&r.a.createElement(C,{styles:{borderColor:"white",margin:"0px"}}),"Save"))))))},x={width:"auto",maxHeight:"450px",objectFit:"contain"},U=a(39),P=a(40),F=(a(65),a(10)),N=function(e){return{type:"ADD_LAST_20_MESSAGES",payload:{messages:e}}},T=function(e){return{type:"ADD_ERROR",payload:{error:e}}},Q=function(e){return{type:"ADD_NEW_MESSAGES",payload:{messages:e}}},B=function(e){return{type:"ADD_10_PREVIOUS_MESSAGES",payload:{messages:e}}},L=function(){return{type:"START_FETCHING_20_LAST_MESSAGES"}},_=function(){return{type:"STOP_FETCHING_20_LAST_MESSAGES"}},G=function(){return{type:"START_FETCHING_10_PREVIOUS_MESSAGES"}},K=function(){return{type:"STOP_FETCHING_10_PREVIOUS_MESSAGES"}},H=function(e){Object(P.a)(a,e);var t=Object(U.a)(a);function a(e){var r;return Object(p.a)(this,a),(r=t.call(this,e)).currentUserID=void 0,r.intersectionObserverRef=void 0,r.firstMessageRef=void 0,r.messagesContainerRef=void 0,r.setFirstMessageRef=void 0,r.observeFirstMessage=function(){r.intersectionObserverRef.current&&r.intersectionObserverRef.current.disconnect(),r.intersectionObserverRef.current=new IntersectionObserver((function(e){e[0].isIntersecting&&r.props.fetch10PreviousMessages()})),r.firstMessageRef&&r.intersectionObserverRef.current&&r.intersectionObserverRef.current.observe(r.firstMessageRef)},r.state={},r.currentUserID=w.getMyUID(),r.intersectionObserverRef=Object(n.createRef)(),r.firstMessageRef=null,r.messagesContainerRef=Object(n.createRef)(),r.setFirstMessageRef=function(e){r.firstMessageRef=e},r}return Object(h.a)(a,[{key:"componentDidMount",value:function(){this.observeFirstMessage(),this.props.fetchLast20Messages(this.props.friendID)}},{key:"getSnapshotBeforeUpdate",value:function(e){return e.messages.length<this.props.messages.length&&this.messagesContainerRef.current?this.messagesContainerRef.current.scrollHeight-this.messagesContainerRef.current.scrollTop:null}},{key:"componentDidUpdate",value:function(e,t,a){e.friendID!==this.props.friendID&&this.props.fetchLast20Messages(this.props.friendID),e.messages!==this.props.messages&&this.observeFirstMessage(),null!==a&&this.messagesContainerRef.current&&(this.messagesContainerRef.current.scrollTop=this.messagesContainerRef.current.scrollHeight-a)}},{key:"render",value:function(){var e=this;return this.props.isFetching10PreviousMessages&&console.log("FETCHING"),r.a.createElement("div",{id:"messages-container",ref:this.messagesContainerRef},r.a.createElement("div",{className:"spinner-container"},this.props.isFetching10PreviousMessages?r.a.createElement(C,null):r.a.createElement("span",{className:"no-more-messages"},"To ju\u017c wszystkie wiadomo\u015bci w tej konwersacji")),this.props.isFetching20LastMessages?r.a.createElement(C,null):this.props.messages.map((function(t,a){var n=t.id,s=t.text,c=t.from,o=0===a;return r.a.createElement("div",Object.assign({key:n},o?{ref:e.setFirstMessageRef}:{},{className:"message-wrapper ".concat(e.currentUserID===c?"message-wrapper--position-right":"message-wrapper--position-left")}),r.a.createElement("span",{className:"message"},s))})))}}]),a}(n.Component),J={fetch10PreviousMessages:function(){return function(){var e=Object(m.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(G()),e.prev=1,e.next=4,w.get10PreviousMessages();case 4:void 0===(a=e.sent)?B([]):(t(K()),t(B(a))),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.log("error in fetchLast10Messages: ",e.t0.message),t(T(e.t0.message));case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()},fetchLast20Messages:function(e){return function(){var t=Object(m.a)(f.a.mark((function t(a,n){var r;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a(L()),t.prev=1,t.next=4,w.getLast20Messages(e);case 4:void 0===(r=t.sent)?N([]):(a(_()),a(N(r))),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),console.log("error in fetchLast20Messages: ",t.t0.message),a(T(t.t0.message));case 12:return t.prev=12,n().chat.messages.length>0&&(console.log("HERE finally"),w.cancelPreviousListener(),w.listenForNewMessages((function(e){return a(Q(e))}),e)),t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[1,8,12,15]])})));return function(e,a){return t.apply(this,arguments)}}()}},W=Object(F.b)((function(e){return{messages:e.chat.messages,isFetching20LastMessages:e.chat.isFetching20LastMessages,isFetching10PreviousMessages:e.chat.isFetching10PreviousMessages}}),J)(H),z=(a(67),function(e){var t=e.friendID,a=Object(F.c)(),s=Object(n.useState)(""),c=Object(l.a)(s,2),o=c[0],i=c[1];return Object(n.useEffect)((function(){})),r.a.createElement("form",{id:"form-chat",onSubmit:function(e){e.preventDefault(),""!==o&&(a(function(e,t){return function(){var a=Object(m.a)(f.a.mark((function a(n,r){var s;return f.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:s=r();try{w.sendMessage(e,t).then((function(){console.log("sendMessage")}))}catch(c){n(T(c.message))}finally{0===s.chat.messages.length&&(console.log("HERE 0"),w.cancelPreviousListener(),w.listenForNewMessages((function(e){return n(Q(e))}),t))}case 2:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}()}(o,t)),i(""))}},r.a.createElement("input",{type:"text",id:"input-chat",value:o,onChange:function(e){return i(e.target.value)},placeholder:"Wpisz wiadomo\u015b\u0107..."}),r.a.createElement("button",{id:"submit-button-chat"},"Send"))}),V=function(){var e=Object(i.g)(),t=(Object(F.c)(),Object(n.useState)([])),a=Object(l.a)(t,2),s=a[0],c=a[1];return Object(n.useEffect)((function(){(function(){var e=Object(m.a)(f.a.mark((function e(){var t,a,n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=w.getMyUID(),e.next=4,w.getUsers();case 4:a=e.sent,n=a.docs.map((function(e){return{displayName:e.data().displayName,id:e.id}})),r=n.filter((function(e){return e.id!==t})),c(r),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log("ERROR IN getFriendsInfo: ",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}})()()}),[]),"/chat"===Object(i.h)().pathname&&s.length&&e.replace("/chat/".concat(s[0].id)),r.a.createElement("div",{className:"container-screen"},r.a.createElement(M,{friendsInfo:s}),r.a.createElement("div",{id:"container-chat"},r.a.createElement(i.d,null,r.a.createElement(i.b,{path:"/chat/:friendID",render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(W,{friendID:e.match.params.friendID}),r.a.createElement(z,{friendID:e.match.params.friendID}))}}))),r.a.createElement(k,{friendName:"Donek"}))},Z=(a(68),function(){var e=Object(n.useState)("donek"),t=Object(l.a)(e,2),a=t[0],s=t[1],c=Object(n.useState)("dominik1@onet.com.pl"),u=Object(l.a)(c,2),A=u[0],g=u[1],d=Object(n.useState)("dupadupa"),f=Object(l.a)(d,2),m=f[0],p=f[1],h=Object(n.useState)("dupadupa"),E=Object(l.a)(h,2),b=E[0],v=E[1],O=Object(i.g)();return r.a.createElement("div",{id:"register-container"},r.a.createElement("form",{id:"register-form",onSubmit:function(e){e.preventDefault(),w.register(a,A,m).then((function(e){O.push("/login")})).catch((function(e){return console.log("REGISTER ERR: ",e)}))}},r.a.createElement("fieldset",null,r.a.createElement("legend",null,"Welcome to"," ",r.a.createElement("span",{className:"register-text-highlight"},"Messenger")),r.a.createElement("input",{type:"text",id:"register-form-name",className:"register-input",placeholder:"Username",value:a,onChange:function(e){return s(e.target.value)}}),r.a.createElement("input",{type:"email",id:"register-form-email",className:"register-input",placeholder:"Email",value:A,onChange:function(e){return g(e.target.value)}}),r.a.createElement("input",{type:"password",id:"register-form-password",placeholder:"Password",className:"register-input",value:m,onChange:function(e){return p(e.target.value)}}),r.a.createElement("input",{type:"password",id:"register-form-password-confirmation",placeholder:"Password confirmation",className:"register-input",value:b,onChange:function(e){return v(e.target.value)}}),r.a.createElement("button",{id:"register-submit-button"},"Sign up"),r.a.createElement("div",{id:"register-bottom-container"},r.a.createElement("span",null," Already have an account?"),r.a.createElement(o.b,{id:"register-bottom-container__link",to:"/login"},"Sign in here!")))))}),Y=function(e){var t=e.children,a=Object(u.a)(e,["children"]);return Object(n.useContext)(O).currentUser?r.a.createElement(i.a,{to:"/chat"}):r.a.createElement(i.b,a,t)},q=a(13),X=a(38),$=a(16),ee={messages:[],friendID:void 0,isFetching20LastMessages:!1,isFetching10PreviousMessages:!1,error:void 0},te=Object(q.c)({chat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_LAST_20_MESSAGES":var a=t.payload.messages;return Object(A.a)({},e,{messages:Object($.a)(a)});case"ADD_NEW_MESSAGES":return Object(A.a)({},e,{messages:[].concat(Object($.a)(e.messages),Object($.a)(t.payload.messages))});case"ADD_10_PREVIOUS_MESSAGES":var n=t.payload.messages;return 0===n.length?e:Object(A.a)({},e,{messages:[].concat(Object($.a)(n),Object($.a)(e.messages))});case"SET_FRIEND_ID":return Object(A.a)({},e,{friendID:t.payload.friendID});case"START_FETCHING_20_LAST_MESSAGES":return Object(A.a)({},e,{isFetching20LastMessages:!0});case"STOP_FETCHING_20_LAST_MESSAGES":return Object(A.a)({},e,{isFetching20LastMessages:!1});case"START_FETCHING_10_PREVIOUS_MESSAGES":return Object(A.a)({},e,{isFetching10PreviousMessages:!0});case"STOP_FETCHING_10_PREVIOUS_MESSAGES":return Object(A.a)({},e,{isFetching10PreviousMessages:!1});case"ADD_ERROR":var r=t.payload.error;return Object(A.a)({},e,{error:r});default:return e}}}),ae=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||q.d,ne=Object(q.e)(te,ae(Object(q.a)(X.a))),re=(F.d,ne);c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(F.a,{store:re},r.a.createElement(S,null,r.a.createElement(o.a,null,r.a.createElement(i.d,null,r.a.createElement(i.a,{exact:!0,from:"/",to:"/chat"}),r.a.createElement(Y,{path:"/login"},r.a.createElement(y,null)),r.a.createElement(Y,{path:"/register"},r.a.createElement(Z,null)),r.a.createElement(j,{path:"/chat"},r.a.createElement(V,null))))))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[41,1,2]]]);
//# sourceMappingURL=main.a39aba37.chunk.js.map